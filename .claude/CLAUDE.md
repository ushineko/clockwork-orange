# Project-Specific Guidelines: clockwork-orange

This file extends the global AIQ-Ralph configuration (`~/.claude/CLAUDE.md`).

---

## Project Overview

- **Type**: Desktop application (GUI + CLI)
- **Language**: Python 3.10+
- **Platforms**: KDE Plasma 6 (Linux), Windows 10/11
- **Framework**: PyQt6 for GUI
- **Purpose**: Wallpaper and lock screen management with plugin system

---

## Relaxed Rules

### Release Safety: Simplified

**Justification**: This is a desktop application with no backend databases, APIs, or infrastructure. Schema migrations and multi-phase rollouts do not apply.

**What this means**:
- Document rollback approach (revert commit, reinstall previous version)
- Skip formal Expand-Migrate-Contract checklists
- Skip ringed rollout planning
- Focus on: Can users easily revert to previous version if needed?

---

## Additional Rules

### Platform-Specific Testing

When making changes:
- Test on Windows if modifying `platform_utils.py` or Windows-specific code
- Test GUI changes with PyQt6
- Run `--self-test` on frozen executables after build changes

### Build Verification

Before releasing Windows builds:
1. Run `.\scripts\build_windows.ps1` (debug build)
2. Execute `.\dist\clockwork-orange.exe --self-test`
3. Verify all imports pass, especially platform-specific ones

---

## Release Workflow

When the user says **"release"** or **"releasing"**, follow this workflow:

### Step 1: Determine Version Bump

Use semantic versioning (semver) to determine the new version:

| Change Type | Version Component | Example |
|-------------|-------------------|---------|
| Bugfix / minor patch | Patch (x.y.**Z**) | v2.7.2 → v2.7.3 |
| New feature | Minor (x.**Y**.0) | v2.7.2 → v2.8.0 |
| Major/breaking change | Major (**X**.0.0) | v2.7.2 → v3.0.0 |

### Step 2: Confirm Version with User

**Before updating `.tag`**, use `AskUserQuestion` to confirm:

```
Current version: v2.7.2
Suggested new version: v2.7.3 (patch bump for bugfix)

Options:
1. Accept v2.7.3
2. Use minor bump (v2.8.0)
3. Use major bump (v3.0.0)
4. Other (specify custom version)
```

### Step 3: Update .tag File

Update the `.tag` file with the confirmed version:
```
v2.7.3
```

### Step 4: Run Release Script

**On Linux/macOS:**
```bash
./release_version.sh
```

**On Windows (via Git Bash or MSYS2):**
```bash
bash release_version.sh
```

The script will:
1. Commit `.tag` if modified
2. Create annotated git tag
3. Push to remote (main branch + tag)

### Step 5: Verify Release

After the script completes:
1. Confirm tag appears on GitHub
2. GitHub Actions will build Windows executable automatically
3. Check Actions workflow for build success

### Release Checklist

- [ ] All tests passing
- [ ] Self-test passes on frozen executable (if Windows changes)
- [ ] Version confirmed with user
- [ ] `.tag` updated
- [ ] `release_version.sh` executed successfully
- [ ] Tag visible on GitHub
- [ ] GitHub Actions build successful

---

## Environment

- **Python**: 3.10+ (3.12 for development)
- **Package Manager**: pip (from requirements.txt)
- **Build Tool**: PyInstaller for Windows executables
- **GUI Framework**: PyQt6

### Key Dependencies
- PyQt6 (GUI)
- Pillow (image processing)
- requests (network)
- PyYAML (configuration)
- watchdog (file system monitoring)
- pywin32 (Windows-specific features)

---

## Release Safety

Stack-specific guidance enabled:
- [x] None (desktop application)

Rollback documentation: **Simplified**
- For code changes: Revert commit, redeploy
- For releases: Users reinstall previous version from GitHub Releases

---

## Security Extensions

### Additional Checks for This Project

- **No network credentials**: API keys (Wallhaven, etc.) should use config files, not hardcoded
- **Safe file operations**: Validate paths for wallpaper sources, avoid path traversal
- **Plugin security**: Plugins should not execute arbitrary code from network sources

---

## Configuration Summary

| Category | Setting | Notes |
|----------|---------|-------|
| Validation Reports | Strict | Required before every commit |
| Code Quality Checks | Strict | Always check for dead code, duplication |
| Test Requirements | Strict | Tests must pass |
| Communication Style | Strict | Factual language, no superlatives |
| Tool Installation | Strict | Always ask before installing |
| Git Standards | Strict | Conventional commits, connectivity checks |
| Release Safety | **Simplified** | Desktop app, no backend infrastructure |
| Security | Mandatory | CVE scanning, OWASP checks |

---

*Generated by /ralph-setup on 2026-02-01*
